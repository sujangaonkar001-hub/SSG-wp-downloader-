<!DOCTYPE html>
<html>
<head>
    <title>WhatsApp DP Proxy</title>
    <style>
        body { font-family: system-ui; max-width: 600px; margin: 50px auto; padding: 20px; }
        input { width: 100%; padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 10px; }
        button { background: #25D366; color: white; border: none; padding: 15px 30px; border-radius: 10px; font-size: 16px; cursor: pointer; width: 100%; margin-top: 10px; }
        #result { margin-top: 20px; text-align: center; }
        #dpImage { max-width: 300px; max-height: 300px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .loading { display: none; color: #666; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
    <h1>üîç WhatsApp DP Proxy</h1>
    <p>Enter phone number (+country code)</p>
    
    <input type="tel" id="phoneInput" placeholder="+1234567890" />
    <button onclick="handleSearch()">Download DP</button>
    
    <div id="loading" class="loading">üîÑ Fetching via proxy...</div>
    <div id="result"></div>

    <script>
        async function handleSearch() {
            const phone = document.getElementById('phoneInput').value;
            if (!phone || phone.length < 10) return alert('Enter full number');
            
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            
            loading.style.display = 'block';
            result.innerHTML = '';
            
            try {
                const res = await fetch(`/api/dp/${phone.replace(/[^\d]/g, '')}`);
                const data = await res.json();
                
                loading.style.display = 'none';
                
                if (data.success) {
                    if (data.image) {
                        // Base64 image
                        result.innerHTML = `
                            <img id="dpImage" src="data:${data.contentType};base64,${data.image}" />
                            <p>‚úÖ Proxy: ${data.source}</p>
                            <a href="data:${data.contentType};base64,${data.image}" download="dp.jpg">üíæ Save HD</a>
                        `;
                    } else if (data.url) {
                        result.innerHTML = `
                            <img id="dpImage" src="${data.url}" />
                            <p>‚úÖ Direct: ${data.source}</p>
                            <a href="${data.url}" target="_blank">üîó Open Full</a>
                        `;
                    }
                } else {
                    result.innerHTML = `<p class="error">‚ùå ${data.message}</p>`;
                }
            } catch {
                loading.style.display = 'none';
                result.innerHTML = '<p class="error">Network error</p>';
            }
        }

        // Enter key
        document.getElementById('phoneInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') handleSearch();
        });
    </script>
</body>
</html>
